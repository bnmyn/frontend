{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to MyDoc For full documentation visit mkdocs.org . Commands mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs help - Print this help message. Project layout mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Home"},{"location":"#welcome-to-mydoc","text":"For full documentation visit mkdocs.org .","title":"Welcome to MyDoc"},{"location":"#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs help - Print this help message.","title":"Commands"},{"location":"#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"about/","text":"to About For full documentation visit mkdocs.org . Commands mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs help - Print this help message. Project layout mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"About"},{"location":"about/#to-about","text":"For full documentation visit mkdocs.org .","title":"to About"},{"location":"about/#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs help - Print this help message.","title":"Commands"},{"location":"about/#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"fastdfs/","text":"\u5b89\u88c5\u914d\u7f6eFastDFS\uff08Ubuntu18.04\uff09 \u5b89\u88c5\u5355\u673a\u7248 \u5b89\u88c5\u6d41\u7a0b \u4e0b\u8f7d\u5b89\u88c5\u5305 \u4e0b\u8f7d\u7684\u5305\u90fd\u5b58\u653e\u5728 ~/caibh/fdfs-package \u76ee\u5f55\u4e0b\u3002 \u4e0b\u8f7d libfastcommon \u3001 fastdfs \u3001 fastdfs-nginx-module \uff1a cd ~/caibh/fdfs-package # -S print server response # -O write documents to file wget https://github.com/happyfish100/libfastcommon/archive/V1.0.39.tar.gz -SO libfastcommon.tar.gz wget https://github.com/happyfish100/fastdfs/archive/V5.11.tar.gz -SO fastdfs.tar.gz wget https://github.com/happyfish100/fastdfs-nginx-module/archive/V1.20.tar.gz -SO fastdfs-nginx-module.tar.gz # \u89e3\u538b tar -xf xxx.tar.gz \u5b89\u88c5 libfastcommon cd ~/caibh/fdfs-package cd libfastcommon-1.0.39 ./make.sh ./make.sh install \u5b89\u88c5 fastdfs cd ~/caibh/fdfs-package cd fastdfs-5.11 ./make.sh ./make.sh install \u5b89\u88c5\u597d\u540e\uff0c\u7a0b\u5e8f\u662f\u5728 /usr/bin \u76ee\u5f55\u4e0b\uff1a $ which fdfs_trackerd /usr/bin/fdfs_trackerd \u800c\u914d\u7f6e\u6587\u4ef6\u662f\u5728 /etc/fdfs \u76ee\u5f55\u4e0b\uff1a $ cd ~/caibh/fdfs-package/fastdfs-5.11 $ ls /etc/fdfs client.conf.sample storage_ids.conf.sample tracker.conf.sample storage.conf.sample \u4f46\u662f\u8fd9\u4e9b\u914d\u7f6e\u6587\u4ef6\u662f\u4e0d\u5168\u7684\uff0c\u800c\u4e14\u90fd\u662f\u6a21\u677f\uff0c\u6240\u4ee5\u9700\u8981\u4ece fastdfs \u5305\u4e2d\u62f7\u8d1d\u8fc7\u6765\uff0c\u5e76\u4fee\u6539\u914d\u7f6e\uff1a $ cd ~/caibh/fdfs-package/fastdfs-5.11/conf $ ls anti-steal.jpg client.conf http.conf mime.types storage.conf storage_ids.conf tracker.conf $ sudo cp ~/caibh/fdfs-package/fastdfs-5.11/conf/* /etc/fdfs \u4fee\u6539\u914d\u7f6e sudo vi /etc/fdfs/tracker.conf\uff1a # the tracker server port port=22122 # the base path to store data and log files base_path=/home/caibh/fdfs # HTTP port on this tracker server http.server_port=9270 sudo vi /etc/fdfs/storage.conf\uff1a # storage\u6240\u5c5e\u7684\u7ec4 group_name=group1 # the storage server port port=23000 # the base path to store data and log files base_path=/home/caibh/fdfs # store_path#, based 0, if store_path0 not exists, it's value is base_path # the paths must be exist store_path0=/home/caibh/fdfs #store_path1=/home/caibh/fdfs2 # tracker\u670d\u52a1\u5668\uff0c\u867d\u7136\u662f\u540c\u4e00\u53f0\u673a\u5668\u4e0a\uff0c\u4f46\u662f\u4e0d\u80fd\u5199127.0.0.1\u3002\u8fd9\u9879\u914d\u7f6e\u53ef\u4ee5\u51fa\u73b0\u4e00\u6b21\u6216\u591a\u6b21 tracker_server=191.8.1.77:22122 # the port of the web server on this storage server http.server_port=8888 sudo vi /etc/fdfs/client.conf\uff1a # the base path to store log files base_path=/home/caibh/fdfs/client # tracker_server can ocur more than once, and tracker_server format is # host:port , host can be hostname or ip address tracker_server=191.8.1.77:22122 #HTTP settings http.tracker_server_port=9270 sudo vi /etc/fdfs/mod_fastdfs.conf\uff1a mod_fastdfs.conf\u662f\u4ece~/caibh/fdfs-package/fastdfs-nginx-module-1.20/src\u4e0b\u9762\u62f7\u8d1d\u5230/etc/fdfs\u76ee\u5f55\u7684\u3002 # the base path to store log files base_path=/tmp # FastDFS tracker_server can ocur more than once, and tracker_server format is # host:port , host can be hostname or ip address # valid only when load_fdfs_parameters_from_tracker is true tracker_server=191.8.1.77:22122 # the port of the local storage server # the default value is 23000 storage_server_port=23000 # the group name of the local storage server group_name=group1 # store_path#, based 0, if store_path0 not exists, it's value is base_path # the paths must be exist # must same as storage.conf store_path0=/home/caibh/fdfs #store_path1=/home/yuqing/fastdfs1 \u914d\u7f6e\u8fc7\u7a0b\u4e2d\u6709\u51e0\u70b9\u8981\u6ce8\u610f\uff1a \u786e\u4fdd\u914d\u7f6e\u4e2d\u7528\u5230\u7684\u76ee\u5f55\u5df2\u7ecf\u521b\u5efa\u4e86\u3002\u6bd4\u5982 ~/fdfs/client \u3001 ~/fdfs/data \u3001 ~/fdfs/logs \u786e\u4fdd\u5404\u79cd\u914d\u7f6e\u6587\u4ef6\u4e4b\u95f4\u5f15\u7528\u7684\u7aef\u53e3\u4e00\u76f4\u3002\u6bd4\u5982\uff1a mod_fastdfs.conf \u6587\u4ef6\u4e2d tracker_server \u7684\u7aef\u53e3\u5e94\u8be5\u8ddf tracker.conf \u4e2d port \u4e00\u81f4\uff1b mod_fastdfs.conf \u6587\u4ef6\u4e2d storage_server_port \u7684\u7aef\u53e3\u5e94\u8be5\u8ddf\u8ddf storage.conf \u4e2d port \u4e00\u81f4\uff1b \u5176\u4ed6\u914d\u7f6e\u6216\u6587\u4ef6\u867d\u7136\u4e0d\u7528\u4fee\u6539\uff0c\u4f46\u662f fastdfs-nginx-module \u6a21\u5757\u4f1a\u7528\u5230\uff1a anti-steal.jpg http.conf mime.types \u542f\u52a8 tracker \u548c storage \uff1a # \u542f\u52a8 fdfs_trackerd /etc/fdfs/tracker.conf start fdfs_storaged /etc/fdfs/storage.conf start # \u67e5\u770b\u65e5\u5fd7 tail -n10 ~/fdfs/logs/trackerd.log tail -n10 ~/fdfs/logs/storaged.log # \u5982\u679c\u65e5\u5fd7\u663e\u793a\u6709\u9519\u8bef\u4fe1\u606f\uff0c\u9700\u8981\u6839\u636e\u4fe1\u606f\u6765\u67e5\u627e\u9519\u8bef\u539f\u56e0 \u7528 fdfs_test \u6d4b\u8bd5\u4e0a\u4f20 $ fdfs_test /etc/fdfs/client.conf upload ~/caibh/test_images/XinXiJuZhiWang.jpg \u5b89\u88c5 fastdfs-nginx-module \uff08\u673a\u5668\u4e0a\u65e0nginx\uff09 \u5230\u5b98\u7f51\u4e0b\u8f7d\u5bf9\u5e94\u7248\u672c\u7684 nginx\u6e90\u7801 \uff0c\u5e76\u89e3\u538b\uff0c\u6539\u540d\u4e3a nginx-src \uff0c\u7136\u540e\u8fdb\u5165 nginx-src \u76ee\u5f55 ./configure --prefix=/opt/nginx --sbin-path=/usr/bin/nginx --add-module=~/caibh/fdfs-package/fastdfs-nginx-module-1.20/src \u4f1a\u63d0\u793a\u7f3a\u5c11\u4f9d\u8d56\u7684\u9519\u8bef\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff1a sudo apt-get install libpcre3 libpcre3-dev sudo apt-get install zlib1g-dev sudo apt-get install openssl libssl-dev \u7f16\u8bd1\u5e76\u5b89\u88c5\uff1a make make install \u4f1a\u9047\u5230\u4e24\u4e2a\u9519\u8bef\uff0c\u89e3\u51b3\u7684\u529e\u6cd5\u5206\u522b\u662f\uff1a \u7b2c\u4e00\u4e2a\uff1a src/core/ngx_murmurhash.c: In function \u2018ngx_murmur_hash2\u2019: src/core/ngx_murmurhash.c:37:11: error: this statement may fall through [-Werror=implicit-fallthrough=] h ^= data[2] 16; ~~^~~~~~~~~~~~~~~~ src/core/ngx_murmurhash.c:38:5: note: here case 2: ^~~~ src/core/ngx_murmurhash.c:39:11: error: this statement may fall through [-Werror=implicit-fallthrough=] h ^= data[1] 8; ~~^~~~~~~~~~~~~~~ src/core/ngx_murmurhash.c:40:5: note: here case 1: ^~~~ \u539f\u56e0\uff0c\u662f\u5c06\u8b66\u544a\u5f53\u6210\u4e86\u9519\u8bef\u5904\u7406\uff0c\u6253\u5f00/nginx-src/objs/Makefile\uff0c \u53bb\u6389CFLAGS\u4e2d\u7684-Werror \u518d\u91cd\u65b0make -Wall \u8868\u793a\u6253\u5f00gcc\u7684\u6240\u6709\u8b66\u544a -Werror\uff0c\u5b83\u8981\u6c42gcc\u5c06\u6240\u6709\u7684\u8b66\u544a\u5f53\u6210\u9519\u8bef\u8fdb\u884c\u5904\u7406 vi objs/Makefile \u7b2c\u4e8c\u4e2a\uff0c#include \"common_define.h\"\uff1a # \u62a5\u9519 Fatal error: can't create objs/addon/src/ngx_http_fastdfs_module.o: Permission denied In file included from /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src/common.c:26:0, from /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src/ngx_http_fastdfs_module.c:6: /usr/include/fastdfs/fdfs_define.h:15:27: fatal error: common_define.h: No such file or directory # \u89e3\u51b3 # \u4fee\u6539fastdfs-nginx-module\u7684src/config\u6587\u4ef6 $ cd /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src $ sudo vi config # \u4fee\u6539\u4e00\u4e0b\u4e24\u9879\uff1a ngx_module_incs= /usr/include/fastdfs /usr/include/fastcommon/ CORE_INCS= $CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/ # \u91cd\u65b0\u8fd0\u884c ./configure --prefix=/opt/nginx --sbin-path=/usr/bin/nginx --add-module=~/caibh/fdfs-package/fastdfs-nginx-module-1.20/src $ pwd /home/xxxx/caibh/nginx-src $ sudo make $ sudo make install \u68c0\u67e5nginx\u662f\u5426\u6b63\u5e38\uff1a # \u68c0\u67e5\u81ea\u5df1\u7f16\u8bd1\u51fa\u6765\u7684nginx\u80fd\u5426\u8fd0\u884c $ ./nginx -v nginx version: nginx/1.10.3 \u914d\u7f6enginx\uff0c\u52a0\u5165\u8def\u7531\u89c4\u5219\uff0c\u6620\u5c04\u5230fastdfs\u7684\u6570\u636e\u76ee\u5f55\uff1a # config for fastdfs-nginx-module server { listen 8777; location /M00 { root ~/fdfs/data; ngx_fastdfs_module; } } \u8bbf\u95ee\uff1a http://191.8.2.203:8777/M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945_big.jpg # \u5982\u679c\u80fd\u770b\u5230\u56fe\u7247\u5219\u8868\u793a\u5b89\u88c5fastdfs-nginx-module\u6210\u529f \u5b89\u88c5 fastdfs-nginx-module \uff08\u673a\u5668\u4e0a\u6709nginx\uff09 \u601d\u8def\uff1a \u5b89\u88c5\u8fc7\u7a0b\u6bd4\u8f83\u590d\u6742\uff0c\u7531\u4e8e\u5f53\u524d\u7cfb\u7edf\u5df2\u7ecf\u6709\u4e00\u4e2anginx\u5728\u8fd0\u884c\u4e86\uff0c\u6240\u4ee5\u8981\u5148\u786e\u8ba4\u5f53\u524d\u7cfb\u7edfnginx\u7684\u7248\u672c\uff0c\u7136\u540e\u5230\u5b98\u7f51\u4e0b\u8f7d\u5bf9\u5e94\u7248\u672c\u7684nginx\u6e90\u7801\uff0c\u7136\u540e\u67e5\u770b\u7cfb\u7edfnginx\u7684\u7f16\u8bd1\u9009\u9879\uff0c\u7528\u4e00\u6a21\u4e00\u6837\u7684\u7f16\u8bd1\u9009\u9879\u5916\u52a0 fastdfs-nginx-module \u7684\u6e90\u7801\uff0c\u91cd\u65b0\u7f16\u8bd1\u4e00\u4e2anginx\u7a0b\u5e8f\u3002\u7528\u65b0\u7684nginx\u66ff\u6362\u7cfb\u7edf\u7684nginx\u3002 \u6ce8\u610f\uff1a \u8fd9\u91cc\u7684\u5b89\u88c5\u573a\u666f\u662ftracker\u548cstorage\u90fd\u88c5\u5728\u540c\u4e00\u4e2a\u673a\u5668\u4e0a\u3002 \u67e5\u770b\u5df2\u5b89\u88c5\u5e76\u5728\u8fd0\u884c\u4e2d\u7684nginx\u7684\u7248\u672c\uff1a $ nginx -v nginx version: nginx/1.10.3 (Ubuntu) \u5230\u5b98\u7f51\u4e0b\u8f7d\u5bf9\u5e94\u7248\u672c\u7684 nginx\u6e90\u7801 \uff0c\u5e76\u89e3\u538b\uff0c\u6539\u540d\u4e3a nginx-src \uff0c\u7136\u540e\u8fdb\u5165 nginx-src \u76ee\u5f55 \u67e5\u770b\u5f53\u524d\u8fd0\u884c\u7684ngxin\u539f\u6765\u7684\u7f16\u8bd1\u9009\u9879\uff1a $ cd ~/caibh/nginx-src $ nginx -V nginx version: nginx/1.10.3 (Ubuntu) built with OpenSSL 1.0.2g 1 Mar 2016 TLS SNI support enabled configure arguments: --with-cc-opt='-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2' --with-ld-opt='-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now' --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-ipv6 --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_addition_module --with-http_dav_module --with-http_geoip_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module --with-http_v2_module --with-http_sub_module --with-http_xslt_module --with-stream --with-stream_ssl_module --with-mail --with-mail_ssl_module --with-threads \u4e3a\u4e86\u65b9\u4fbf\u7f16\u8f91\uff0c\u590d\u5236\u4e0a\u9762\u4fe1\u606f\uff0c\u5728 nginx-src \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a custom_configure.sh \u6587\u4ef6\uff0c\u628a\u590d\u5236\u7684\u5185\u5bb9\u62f7\u8d1d\u8fdb\u53bb\uff0c\u5e76\u5728\u6700\u540e\u52a0\u4e0a fastdfs-nginx-module \u7684\u6e90\u7801\uff1a $ cd ~/caibh/nginx-src $ cat custom_configure.sh ./configure \\ --with-cc-opt='-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2' \\ --with-ld-opt='-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now' \\ --prefix=/usr/share/nginx \\ --conf-path=/etc/nginx/nginx.conf \\ --http-log-path=/var/log/nginx/access.log \\ --error-log-path=/var/log/nginx/error.log \\ --lock-path=/var/lock/nginx.lock \\ --pid-path=/run/nginx.pid \\ --http-client-body-temp-path=/var/lib/nginx/body \\ --http-fastcgi-temp-path=/var/lib/nginx/fastcgi \\ --http-proxy-temp-path=/var/lib/nginx/proxy \\ --http-scgi-temp-path=/var/lib/nginx/scgi \\ --http-uwsgi-temp-path=/var/lib/nginx/uwsgi \\ --with-debug \\ --with-pcre-jit \\ --with-ipv6 \\ --with-http_ssl_module \\ --with-http_stub_status_module \\ --with-http_realip_module \\ --with-http_auth_request_module \\ --with-http_addition_module \\ --with-http_dav_module \\ --with-http_geoip_module \\ --with-http_gunzip_module \\ --with-http_gzip_static_module \\ --with-http_image_filter_module \\ --with-http_v2_module \\ --with-http_sub_module \\ --with-http_xslt_module \\ --with-stream \\ --with-stream_ssl_module \\ --with-mail \\ --with-mail_ssl_module \\ --with-threads \\ --add-module=~/caibh/fdfs-package/fastdfs-nginx-module-1.20/src \u6267\u884c custom_configure.sh \uff1a # ~/caibh/nginx-src # \u6267\u884c\u7f16\u8bd1 $ sudo ./custom_configure.sh # \u62a5\u9519 ./configure: error: the HTTP XSLT module requires the libxml2/libxslt libraries. You can either do not enable the module or install the libraries. # \u89e3\u51b3 sudo apt-get install libxml2 libxml2-dev libxslt-dev # \u518d\u6b21\u6267\u884c $ sudo ./custom_configure.sh # \u62a5\u9519 ./configure: error: the HTTP image filter module requires the GD library. You can either do not enable the module or install the libraries. #\u89e3\u51b3 sudo apt-get install libgd-dev # \u518d\u6b21\u6267\u884c $ sudo ./custom_configure.sh # \u62a5\u9519 ./configure: error: the GeoIP module requires the GeoIP library. You can either do not enable the module or install the library. # \u641c\u7d22 $ sudo apt-cache search geoip geoclue-ubuntu-geoip - Provide positioning for GeoClue via Ubuntu GeoIP services geoip-bin - IP lookup command line tools that use the GeoIP library geoip-database - IP lookup command line tools that use the GeoIP library (country database) geoip-dbg - debugging symbols for the GeoIP packages libgeoip-dev - Development files for the GeoIP library ..... # \u89e3\u51b3 $ sudo apt-install libgeoip-dev \u6267\u884c\u540e\u6709\u7528\u7684\u4fe1\u606f\uff0c\u901a\u8fc7\u8fd9\u4e9b\u4fe1\u606f\u53ef\u4ee5\u77e5\u9053\u7f16\u8bd1\u51fa\u6765\u7684nginx\u4f1a\u88c5\u5230\u54ea\u91cc\uff0c\u914d\u7f6e\u6587\u4ef6\u4f1a\u653e\u5728\u54ea\u91cc\uff0c\u9519\u8bef\u65e5\u5fd7\u4f1a\u653e\u5728\u54ea\u91cc\uff1a Configuration summary + using threads + using system PCRE library + using system OpenSSL library + md5: using OpenSSL library + sha1: using OpenSSL library + using system zlib library nginx path prefix: /usr/share/nginx nginx binary file: /usr/share/nginx/sbin/nginx nginx modules path: /usr/share/nginx/modules nginx configuration prefix: /etc/nginx nginx configuration file: /etc/nginx/nginx.conf nginx pid file: /run/nginx.pid nginx error log file: /var/log/nginx/error.log nginx http access log file: /var/log/nginx/access.log nginx http client request body temporary files: /var/lib/nginx/body nginx http proxy temporary files: /var/lib/nginx/proxy nginx http fastcgi temporary files: /var/lib/nginx/fastcgi nginx http uwsgi temporary files: /var/lib/nginx/uwsgi nginx http scgi temporary files: /var/lib/nginx/scgi \u505c\u6b62nginx\uff0c\u5e76\u5907\u4efd\u539f\u6765\u7684nginx\u6267\u884c\u6587\u4ef6\uff0c\u548c\u914d\u7f6e\u6587\u4ef6\uff1a $ which nginx /usr/sbin/nginx $ sudo cp /usr/sbin/nginx /usr/sbin/nginx_org_bak $ sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak \u7ee7\u7eed\u5728 nginx-src \u76ee\u5f55\u6267\u884c make \u548c make install \uff1a $ cd ~/caibh/nginx-src $ sudo make # \u62a5\u9519 Fatal error: can't create objs/addon/src/ngx_http_fastdfs_module.o: Permission denied In file included from /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src/common.c:26:0, from /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src/ngx_http_fastdfs_module.c:6: /usr/include/fastdfs/fdfs_define.h:15:27: fatal error: common_define.h: No such file or directory # \u89e3\u51b3 # \u4fee\u6539fastdfs-nginx-module\u7684src/config\u6587\u4ef6 $ cd /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src $ sudo vi config # \u4fee\u6539\u4e00\u4e0b\u4e24\u9879\uff1a ngx_module_incs= /usr/include/fastdfs /usr/include/fastcommon/ CORE_INCS= $CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/ # \u91cd\u65b0\u8fd0\u884c nginx-src/custom_configure.sh $ pwd /home/xxxx/caibh/nginx-src $ sudo ./custom_configure.sh $ sudo make $ sudo make install # make install \u4f1a\u5728/usr/share/nginx/sbin\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2a\u540d\u4e3anginx\u7684\u53ef\u6267\u884c\u6587\u4ef6 $ sudo ls /usr/share/nginx html sbin \u5173\u95ed\u7cfb\u7edf\u539f\u6709\u7684nginx\uff0c\u5e76\u5907\u4efd\u597d\u7cfb\u7edf\u539f\u6765\u7684nginx\u6587\u4ef6\uff1a sudo nginx -s stop cd /usr/sbin sudo cp mv /usr/sbin/nginx /usr/sbin/nginx_bak \u5907\u4efd\u597d\u540e\u521b\u5efa\u4e00\u4e2a\u8f6f\u94fe\u63a5\uff0c\u653e\u5728 /usr/sbin \u76ee\u5f55\u4e0b\uff1a # \u68c0\u67e5\u81ea\u5df1\u7f16\u8bd1\u51fa\u6765\u7684nginx\u80fd\u5426\u8fd0\u884c $ ./nginx -v nginx version: nginx/1.10.3 # \u521b\u5efa\u8f6f\u94fe\u63a5 $ sudo ln -s /usr/share/nginx/sbin/nginx /usr/sbin/nginx \u914d\u7f6enginx\uff0c\u52a0\u5165\u8def\u7531\u89c4\u5219\uff0c\u6620\u5c04\u5230fastdfs\u7684\u6570\u636e\u76ee\u5f55\uff1a # config for fastdfs-nginx-module server { listen 8777; location /M00 { root ~/fdfs/data; ngx_fastdfs_module; } } \u5f00\u653e\u7aef\u53e3\uff1a sudo iptables -A IN_public_allow -p tcp --dport 8777 -j ACCEPT sudo iptables -L -n \u6d4b\u8bd5\u4e0a\u4f20\u56fe\u7247\uff1a $ fdfs_test /etc/fdfs/client.conf upload ~/caibh/test_images/XinXiJuZhiWang.jpg This is FastDFS client test program v5.11 Copyright (C) 2008, Happy Fish / YuQing FastDFS may be copied only under the terms of the GNU General Public License V3, which may be found in the FastDFS source kit. Please visit the FastDFS Home Page http://www.csource.org/ for more detail. [2019-02-22 14:54:33] DEBUG - base_path=/home/xxxx/fdfs/client, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0 tracker_query_storage_store_list_without_group: server 1. group_name=, ip_addr=191.8.2.203, port=23000 group_name=group1, ip_addr=191.8.2.203, port=23000 storage_upload_by_filename group_name=group1, remote_filename=M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945.jpg source ip address: 191.8.2.203 file timestamp=2019-02-22 14:54:33 file size=68829 file crc32=1940417678 example file url: http://191.8.2.203:9270/group1/M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945.jpg storage_upload_slave_by_filename group_name=group1, remote_filename=M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945_big.jpg source ip address: 191.8.2.203 file timestamp=2019-02-22 14:54:33 file size=68829 file crc32=1940417678 example file url: http://191.8.2.203:9270/group1/M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945_big.jpg \u8bbf\u95ee\uff1a http://191.8.2.203:8777/M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945_big.jpg # \u5982\u679c\u80fd\u770b\u5230\u56fe\u7247\u5219\u8868\u793a\u5b89\u88c5fastdfs-nginx-module\u6210\u529f \u9644\u5f551\uff1aFastDFS \u5b98\u7f51\u4ecb\u7ecd FastDFS\u662f\u4e00\u6b3e\u9ad8\u6027\u80fd\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002\u4e3b\u8981\u529f\u80fd\u5305\u62ec\uff1a\u6587\u4ef6\u5b58\u50a8\uff0c\u6587\u4ef6\u540c\u6b65\uff0c\u6587\u4ef6\u8bbf\u95ee\uff08\u4e0a\u4f20\u4e0b\u8f7d\uff09\u3002\u5b83\u53ef\u4ee5\u89e3\u51b3\u9ad8\u5bb9\u91cf\u548c\u8d1f\u8f7d\u5747\u8861\u7684\u95ee\u9898\u3002FastDFS\u9002\u5408\u7528\u6765\u505a\u6587\u4ef6\u76f8\u5173\u7684\u7f51\u7ad9\uff0c\u5982\u56fe\u7247\u5206\u4eab\u3001\u89c6\u9891\u5206\u4eab\u7b49\u3002 FastDFS\u6709\u4e24\u79cd\u89d2\u8272\uff1a tracker \u548c storage \u3002 tracker \u8d1f\u8d23\u6587\u4ef6\u8bbf\u95ee\u7684\u8ddf\u8e2a\u548c\u8d1f\u8f7d\u5747\u8861\u3002 storage \u8d1f\u8d23\u5b58\u50a8\u6587\u4ef6\uff0c\u5b83\u7684\u529f\u80fd\u5305\u62ec\uff1a\u6587\u4ef6\u5b58\u50a8\u3001\u6587\u4ef6\u540c\u6b65\u3001\u63d0\u4f9b\u6587\u4ef6\u8bbf\u95ee\u63a5\u53e3\uff0c storage \u8fd8\u8d1f\u8d23\u7ba1\u7406\u6587\u4ef6\u7684\u5143\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u662f\u4ee5\u952e\u503c\u5bf9\u7684\u5f62\u5f0f\u8868\u793a\u7684\uff0c\u5982\uff1awidth=1024\uff0c\u952e\u662f\u201cwidth\u201d\uff0c\u503c\u662f\u201c1024\u201d\u3002 tracker \u548c storage \u53ef\u4ee5\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u670d\u52a1\u5668\u3002\u5728 tracker \u6216 storage \u7684\u96c6\u7fa4\u4e2d\uff0c\u4efb\u4f55\u65f6\u5019\u90fd\u53ef\u4ee5\u4ece\u4e2d\u5220\u9664\u670d\u52a1\u5668\uff0c\u5bf9\u7ebf\u4e0a\u670d\u52a1\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\u3002 tracker \u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u5668\u662f\u70b9\u5bf9\u70b9\u7684\u3002 \u5b58\u50a8\u670d\u52a1\u5668\u4ee5 \u5377/\u7ec4 \u5f62\u5f0f\u7ec4\u7ec7\uff0c\u4ee5\u83b7\u53d6\u9ad8\u5bb9\u91cf\u3002\u5b58\u50a8\u7cfb\u7edf\u5305\u62ec\u4e00\u4e2a\u6216\u591a\u4e2a\u5377\uff0c\u5377\u4e0e\u5377\u4e4b\u95f4\u7684\u6587\u4ef6\u662f\u76f8\u4e92\u72ec\u7acb\u7684\u3002\u6574\u4e2a\u5b58\u50a8\u7cfb\u7edf\u7684\u603b\u5bb9\u91cf\u7b49\u4e8e\u6240\u6709\u5377\u7684\u5bb9\u91cf\u4e4b\u548c\u3002\u4e00\u4e2a\u6587\u4ef6\u5377\u5305\u62ec\u4e00\u4e2a\u6216\u591a\u4e2a\u5b58\u50a8\u670d\u52a1\u5668\uff0c\u4e00\u4e2a\u5377\u4e2d\u7684\u5b58\u50a8\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u6587\u4ef6\u662f\u4e00\u6837\u7684\u3002\u4e00\u4e2a\u6587\u4ef6\u5377\u4e2d\u7684\u670d\u52a1\u5668\u4f1a\u4e92\u76f8\u5907\u4efd\uff0c\u4e14\u8fd9\u4e9b\u670d\u52a1\u5668\u4e4b\u95f4\u662f\u8d1f\u8f7d\u5747\u8861\u7684\u3002\u5f53\u6dfb\u52a0\u4e00\u4e2a\u5b58\u50a8\u670d\u52a1\u5668\u5230\u4e00\u4e2a\u5377\u7684\u65f6\u5019\uff0c\u5377\u4e2d\u7684\u6587\u4ef6\u4f1a\u81ea\u52a8\u590d\u5236\u5230\u65b0\u7684\u670d\u52a1\u5668\uff0c\u590d\u5236\u5b8c\u4ee5\u540e\uff0c\u7cfb\u7edf\u4f1a\u628a\u65b0\u670d\u52a1\u5668\u5207\u6362\u5230\u7ebf\u4e0a\uff0c\u5df2\u63d0\u4f9b\u5b58\u50a8\u670d\u52a1\u3002 \u5f53\u5b58\u50a8\u5bb9\u91cf\u4e0d\u8db3\u65f6\uff0c\u4f60\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u5377\u6765\u6269\u5c55\u5b58\u50a8\u5bb9\u91cf\u3002 \u4e00\u4e2a\u6587\u4ef6\u7684\u6807\u8bc6\u5305\u62ec\u4e24\u90e8\u5206\uff1a\u5377\u540d\u548c\u6587\u4ef6\u540d \u9644\u5f552\uff1aFastDFS\u5b98\u65b9INSTALL\u6587\u4ef6 step 1. \u4e0b\u8f7d\u5b89\u88c5 libfastcommon \u5730\u5740\uff1a https://github.com/happyfish1... step 2. \u4e0b\u8f7d\u5b89\u88c5 FastDFS \u89e3\u538b\uff1a tar xzf FastDFS_v5.08.tar.gz step 3. \u8fdb\u5165FastDFS\u7684\u76ee\u5f55 cd FastDFS step 4. \u6267\u884cmake: ./make.sh step 5. \u6267\u884cmake install ./make.sh install step 6. \u4fee\u6539 tracker \u548c storage \u7684\u914d\u7f6e\u6587\u4ef6\uff1a /etc/fdfs/tracker.conf \u51e0\u4e2a\u91cd\u8981\u7684\u914d\u7f6e\uff1a # the tracker server port port=22122 # the base path to store data and log files base_path=/home/caibh/fdfs # which group to upload file # when store_lookup set to 1, must set store_group to the group name store_group=group2 # HTTP port on this tracker server http.server_port=9270 /etc/fdfs/storage.conf \u51e0\u4e2a\u91cd\u8981\u7684\u914d\u7f6e\uff1a # the storage server port port=23000 # the base path to store data and log files base_path=/home/caibh/fdfs # store_path#, based 0, if store_path0 not exists, it's value is base_path # the paths must be exist store_path0=/home/caibh/fdfs #store_path1=/home/caibh/fdfs2 # tracker_server can ocur more than once, and tracker_server format is # host:port , host can be hostname or ip address # \u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u914d\u7f6etracker\u548cstorage\u65f6\uff0c\u8fd9\u91cc\u5982\u679c\u662f127.0.0.1\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u8981\u914d\u7f6e\u771f\u6b63\u7684ip\u5730\u5740\u3002 tracker_server=191.8.1.77:22122 # the port of the web server on this storage server http.server_port=8888 step 7. run server programs \u542f\u52a8tracker\uff1a /usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart in Linux, you can start fdfs_trackerd as a service: /sbin/service fdfs_trackerd start \u542f\u52a8storage\uff1a /usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart in Linux, you can start fdfs_storaged as a service: /sbin/service fdfs_storaged start step 8. \u6d4b\u8bd5 \u4fee\u6539\u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6\uff1a /etc/fdfs/client.conf \u51e0\u4e2a\u91cd\u8981\u7684\u914d\u7f6e\uff1a # the base path to store log files base_path=/home/caibh/fdfs/client # tracker_server can ocur more than once, and tracker_server format is # host:port , host can be hostname or ip address tracker_server=191.8.1.77:22122 #HTTP settings http.tracker_server_port=9270 run the client test program: /usr/bin/fdfs_test client_conf_filename operation /usr/bin/fdfs_test1 client_conf_filename operation \u4f8b\u5982\u4e0a\u4f20\u4e00\u4e2a\u56fe\u7247\u6587\u4ef6\uff1a caibh@pc:~$ fdfs_test /etc/fdfs/client.conf upload /develop/fastdfs/test_file/LiuLangDiQiu.jpg This is FastDFS client test program v5.11 Copyright (C) 2008, Happy Fish / YuQing FastDFS may be copied only under the terms of the GNU General Public License V3, which may be found in the FastDFS source kit. Please visit the FastDFS Home Page http://www.csource.org/ for more detail. [2019-02-19 11:32:30] DEBUG - base_path=/home/caibh/fdfs/client, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0 tracker_query_storage_store_list_without_group: server 1. group_name=, ip_addr=191.8.1.77, port=23000 group_name=group1, ip_addr=191.8.1.77, port=23000 storage_upload_by_filename group_name=group1, remote_filename=M00/00/00/vwgBTVxreM6AD-mcAAEE_qeEI2s285.jpg source ip address: 191.8.1.77 file timestamp=2019-02-19 11:32:30 file size=66814 file crc32=2810454891 example file url: http://191.8.1.77:9270/group1/M00/00/00/vwgBTVxreM6AD-mcAAEE_qeEI2s285.jpg storage_upload_slave_by_filename group_name=group1, remote_filename=M00/00/00/vwgBTVxreM6AD-mcAAEE_qeEI2s285_big.jpg source ip address: 191.8.1.77 file timestamp=2019-02-19 11:32:30 file size=66814 file crc32=2810454891 example file url: http://191.8.1.77:9270/group1/M00/00/00/vwgBTVxreM6AD-mcAAEE_qeEI2s285_big.jpg step 9. \u67e5\u770b\u72b6\u6001 run the monitor program: /usr/bin/fdfs_monitor client_conf_filename # \u5982\uff1a caibh@pc:~$ fdfs_monitor /etc/fdfs/storage.conf [2019-02-19 10:25:09] DEBUG - base_path=/home/caibh/fdfs, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0 server_count=1, server_index=0 tracker server is 191.8.1.77:22122 group count: 1 Group 1: group name = group1 disk total space = 111868 MB disk free space = 62228 MB trunk free space = 0 MB storage server count = 1 active server count = 1 storage server port = 23000 storage HTTP port = 8888 store path count = 1 subdir count per path = 256 current write server index = 0 current trunk file id = 0 Storage 1: id = 191.8.1.77 ip_addr = 191.8.1.77 (191-8-1-77.user.vivozap.com.br) ACTIVE http domain = version = 5.11 join time = 2019-02-19 10:22:53 up time = 2019-02-19 10:22:53 total storage = 111868 MB free storage = 62228 MB upload priority = 10 store_path_count = 1 subdir_count_per_path = 256 storage_port = 23000 storage_http_port = 8888 tracker server config file sample please see conf/tracker.conf storage server config file sample please see conf/storage.conf client config file sample please see conf/client.conf Item detail server common items item name type default Must base_path string Y disabled boolean false N bind_addr string N network_timeout int 30(s) N max_connections int 256 N log_level string info N run_by_group string N run_by_user string N allow_hosts string * N sync_log_buff_interval int 10(s) N thread_stack_size string 1M N memo: base_path is the base path of sub dirs: data and logs. base_path must exist and it's sub dirs will be automatically created if not exist. $base_path/data: store data files $base_path/logs: store log files log_level is the standard log level as syslog, case insensitive emerg: for emergency alert crit: for critical error warn: for warning notice info debug allow_hosts can ocur more than once, host can be hostname or ip address, \"*\" means match all ip addresses, can use range like this: 10.0.1.[1-15,20] or host[01-08,20-25].domain.com, for example: allow_hosts=10.0.1.[1-15,20] allow_hosts=host[01-08,20-25].domain.com tracker server items item name type default Must item name type default Must port int 22000 N store_lookup int 0 N store_group string N store_server int 0 N store_path int 0 N download_server int 0 N reserved_storage_space string 1GB N memo: the value of store_lookup is: 0: round robin (default) 1: specify group 2: load balance (supported since V1.1) store_group is the name of group to store files. when store_lookup set to 1(specify group), store_group must be set to a specified group name. reserved_storage_space is the reserved storage space for system or other applications. if the free(available) space of any stoarge server in a group = reserved_storage_space, no file can be uploaded to this group (since V1.1) bytes unit can be one of follows: G or g for gigabyte(GB) M or m for megabyte(MB) K or k for kilobyte(KB) no unit for byte(B) storage server items item name type default Must group_name string Y tracker_server string Y port int 23000 N heart_beat_interval int 30(s) N stat_report_interval int 300(s) N sync_wait_msec int 100(ms) N sync_interval int 0(ms) N sync_start_time string 00:00 N sync_end_time string 23:59 N store_path_count int 1 N store_path0 string base_path N store_path# string N subdir_count_per_path int 256 N check_file_duplicate boolean 0 N key_namespace string N keep_alive boolean 0 N sync_binlog_buff_interval int 60s N memo: tracker_server can ocur more than once, and tracker_server format is \"host:port\", host can be hostname or ip address. store_path#, # for digital, based 0 check_file_duplicate: when set to true, must work with FastDHT server, more detail please see INSTALL of FastDHT. FastDHT download page: http://code.google.com/p/fast... key_namespace: FastDHT key namespace, can't be empty when check_file_duplicate is true. the key namespace should short as possible \u9644\u5f553\uff1aFastDFS Nginx\u6a21\u5757\u5b98\u65b9INSTALL\u6587\u4ef6 step 1. first install the FastDFS storage server and client library, the FastDFS version should = 5.11. download address: https://github.com/happyfish1... step 2. install nginx server \u200b FastDFS nginx module test passed with nginx 1.15.1, \u200b my nginx installed in /usr/local/nginx step 3. download FastDFS nginx module source package and unpack it, such as: cd /home/yuqing git clone https://github.com/happyfish100/fastdfs step 4. enter the nginx source dir, compile and install the module, such as: cd nginx-1.15.1 ./configure --add-module=/home/yuqing/fastdfs-nginx-module/src make; make install \u6ce8\u610f: before compile, you can change FDFS_OUTPUT_CHUNK_SIZE and FDFS_MOD_CONF_FILENAME macro in the config file as: CFLAGS=\"$CFLAGS -D_FILE_OFFSET_BITS=64 -DFDFS_OUTPUT_CHUNK_SIZE='256*1024' -DFDFS_MOD_CONF_FILENAME='\\\"/etc/fdfs/mod_fastdfs.conf\\\"'\" step 5. config the nginx config file such as nginx.conf, add the following lines: location /M00 { root /home/yuqing/fastdfs/data; ngx_fastdfs_module; } step 6. \u521b\u5efa\u8f6f\u94fe\u63a5 ${fastdfs_base_path}/data/M00 \u94fe\u63a5\u5230 ${fastdfs_base_path}/data \uff0c\u547d\u4ee4\u5982\u4e0b\uff1a ln -s /home/yuqing/fastdfs/data /home/yuqing/fastdfs/data/M00 step 7. change the config file /etc/fdfs/mod_fastdfs.conf, more detail please see it step 8. \u91cd\u542fnginx\uff1a /usr/local/nginx/sbin/nginx -s stop; /usr/local/nginx/sbin/nginx","title":"FastDFS"},{"location":"fastdfs/#fastdfsubuntu1804","text":"","title":"\u5b89\u88c5\u914d\u7f6eFastDFS\uff08Ubuntu18.04\uff09"},{"location":"fastdfs/#_1","text":"","title":"\u5b89\u88c5\u5355\u673a\u7248"},{"location":"fastdfs/#_2","text":"","title":"\u5b89\u88c5\u6d41\u7a0b"},{"location":"fastdfs/#_3","text":"\u4e0b\u8f7d\u7684\u5305\u90fd\u5b58\u653e\u5728 ~/caibh/fdfs-package \u76ee\u5f55\u4e0b\u3002 \u4e0b\u8f7d libfastcommon \u3001 fastdfs \u3001 fastdfs-nginx-module \uff1a cd ~/caibh/fdfs-package # -S print server response # -O write documents to file wget https://github.com/happyfish100/libfastcommon/archive/V1.0.39.tar.gz -SO libfastcommon.tar.gz wget https://github.com/happyfish100/fastdfs/archive/V5.11.tar.gz -SO fastdfs.tar.gz wget https://github.com/happyfish100/fastdfs-nginx-module/archive/V1.20.tar.gz -SO fastdfs-nginx-module.tar.gz # \u89e3\u538b tar -xf xxx.tar.gz","title":"\u4e0b\u8f7d\u5b89\u88c5\u5305"},{"location":"fastdfs/#libfastcommon","text":"cd ~/caibh/fdfs-package cd libfastcommon-1.0.39 ./make.sh ./make.sh install","title":"\u5b89\u88c5 libfastcommon"},{"location":"fastdfs/#fastdfs","text":"cd ~/caibh/fdfs-package cd fastdfs-5.11 ./make.sh ./make.sh install \u5b89\u88c5\u597d\u540e\uff0c\u7a0b\u5e8f\u662f\u5728 /usr/bin \u76ee\u5f55\u4e0b\uff1a $ which fdfs_trackerd /usr/bin/fdfs_trackerd \u800c\u914d\u7f6e\u6587\u4ef6\u662f\u5728 /etc/fdfs \u76ee\u5f55\u4e0b\uff1a $ cd ~/caibh/fdfs-package/fastdfs-5.11 $ ls /etc/fdfs client.conf.sample storage_ids.conf.sample tracker.conf.sample storage.conf.sample \u4f46\u662f\u8fd9\u4e9b\u914d\u7f6e\u6587\u4ef6\u662f\u4e0d\u5168\u7684\uff0c\u800c\u4e14\u90fd\u662f\u6a21\u677f\uff0c\u6240\u4ee5\u9700\u8981\u4ece fastdfs \u5305\u4e2d\u62f7\u8d1d\u8fc7\u6765\uff0c\u5e76\u4fee\u6539\u914d\u7f6e\uff1a $ cd ~/caibh/fdfs-package/fastdfs-5.11/conf $ ls anti-steal.jpg client.conf http.conf mime.types storage.conf storage_ids.conf tracker.conf $ sudo cp ~/caibh/fdfs-package/fastdfs-5.11/conf/* /etc/fdfs","title":"\u5b89\u88c5 fastdfs"},{"location":"fastdfs/#_4","text":"sudo vi /etc/fdfs/tracker.conf\uff1a # the tracker server port port=22122 # the base path to store data and log files base_path=/home/caibh/fdfs # HTTP port on this tracker server http.server_port=9270 sudo vi /etc/fdfs/storage.conf\uff1a # storage\u6240\u5c5e\u7684\u7ec4 group_name=group1 # the storage server port port=23000 # the base path to store data and log files base_path=/home/caibh/fdfs # store_path#, based 0, if store_path0 not exists, it's value is base_path # the paths must be exist store_path0=/home/caibh/fdfs #store_path1=/home/caibh/fdfs2 # tracker\u670d\u52a1\u5668\uff0c\u867d\u7136\u662f\u540c\u4e00\u53f0\u673a\u5668\u4e0a\uff0c\u4f46\u662f\u4e0d\u80fd\u5199127.0.0.1\u3002\u8fd9\u9879\u914d\u7f6e\u53ef\u4ee5\u51fa\u73b0\u4e00\u6b21\u6216\u591a\u6b21 tracker_server=191.8.1.77:22122 # the port of the web server on this storage server http.server_port=8888 sudo vi /etc/fdfs/client.conf\uff1a # the base path to store log files base_path=/home/caibh/fdfs/client # tracker_server can ocur more than once, and tracker_server format is # host:port , host can be hostname or ip address tracker_server=191.8.1.77:22122 #HTTP settings http.tracker_server_port=9270 sudo vi /etc/fdfs/mod_fastdfs.conf\uff1a mod_fastdfs.conf\u662f\u4ece~/caibh/fdfs-package/fastdfs-nginx-module-1.20/src\u4e0b\u9762\u62f7\u8d1d\u5230/etc/fdfs\u76ee\u5f55\u7684\u3002 # the base path to store log files base_path=/tmp # FastDFS tracker_server can ocur more than once, and tracker_server format is # host:port , host can be hostname or ip address # valid only when load_fdfs_parameters_from_tracker is true tracker_server=191.8.1.77:22122 # the port of the local storage server # the default value is 23000 storage_server_port=23000 # the group name of the local storage server group_name=group1 # store_path#, based 0, if store_path0 not exists, it's value is base_path # the paths must be exist # must same as storage.conf store_path0=/home/caibh/fdfs #store_path1=/home/yuqing/fastdfs1 \u914d\u7f6e\u8fc7\u7a0b\u4e2d\u6709\u51e0\u70b9\u8981\u6ce8\u610f\uff1a \u786e\u4fdd\u914d\u7f6e\u4e2d\u7528\u5230\u7684\u76ee\u5f55\u5df2\u7ecf\u521b\u5efa\u4e86\u3002\u6bd4\u5982 ~/fdfs/client \u3001 ~/fdfs/data \u3001 ~/fdfs/logs \u786e\u4fdd\u5404\u79cd\u914d\u7f6e\u6587\u4ef6\u4e4b\u95f4\u5f15\u7528\u7684\u7aef\u53e3\u4e00\u76f4\u3002\u6bd4\u5982\uff1a mod_fastdfs.conf \u6587\u4ef6\u4e2d tracker_server \u7684\u7aef\u53e3\u5e94\u8be5\u8ddf tracker.conf \u4e2d port \u4e00\u81f4\uff1b mod_fastdfs.conf \u6587\u4ef6\u4e2d storage_server_port \u7684\u7aef\u53e3\u5e94\u8be5\u8ddf\u8ddf storage.conf \u4e2d port \u4e00\u81f4\uff1b \u5176\u4ed6\u914d\u7f6e\u6216\u6587\u4ef6\u867d\u7136\u4e0d\u7528\u4fee\u6539\uff0c\u4f46\u662f fastdfs-nginx-module \u6a21\u5757\u4f1a\u7528\u5230\uff1a anti-steal.jpg http.conf mime.types","title":"\u4fee\u6539\u914d\u7f6e"},{"location":"fastdfs/#trackerstorage","text":"# \u542f\u52a8 fdfs_trackerd /etc/fdfs/tracker.conf start fdfs_storaged /etc/fdfs/storage.conf start # \u67e5\u770b\u65e5\u5fd7 tail -n10 ~/fdfs/logs/trackerd.log tail -n10 ~/fdfs/logs/storaged.log # \u5982\u679c\u65e5\u5fd7\u663e\u793a\u6709\u9519\u8bef\u4fe1\u606f\uff0c\u9700\u8981\u6839\u636e\u4fe1\u606f\u6765\u67e5\u627e\u9519\u8bef\u539f\u56e0","title":"\u542f\u52a8tracker\u548cstorage\uff1a"},{"location":"fastdfs/#fdfs_test","text":"$ fdfs_test /etc/fdfs/client.conf upload ~/caibh/test_images/XinXiJuZhiWang.jpg","title":"\u7528fdfs_test\u6d4b\u8bd5\u4e0a\u4f20"},{"location":"fastdfs/#fastdfs-nginx-modulenginx","text":"\u5230\u5b98\u7f51\u4e0b\u8f7d\u5bf9\u5e94\u7248\u672c\u7684 nginx\u6e90\u7801 \uff0c\u5e76\u89e3\u538b\uff0c\u6539\u540d\u4e3a nginx-src \uff0c\u7136\u540e\u8fdb\u5165 nginx-src \u76ee\u5f55 ./configure --prefix=/opt/nginx --sbin-path=/usr/bin/nginx --add-module=~/caibh/fdfs-package/fastdfs-nginx-module-1.20/src \u4f1a\u63d0\u793a\u7f3a\u5c11\u4f9d\u8d56\u7684\u9519\u8bef\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff1a sudo apt-get install libpcre3 libpcre3-dev sudo apt-get install zlib1g-dev sudo apt-get install openssl libssl-dev \u7f16\u8bd1\u5e76\u5b89\u88c5\uff1a make make install \u4f1a\u9047\u5230\u4e24\u4e2a\u9519\u8bef\uff0c\u89e3\u51b3\u7684\u529e\u6cd5\u5206\u522b\u662f\uff1a \u7b2c\u4e00\u4e2a\uff1a src/core/ngx_murmurhash.c: In function \u2018ngx_murmur_hash2\u2019: src/core/ngx_murmurhash.c:37:11: error: this statement may fall through [-Werror=implicit-fallthrough=] h ^= data[2] 16; ~~^~~~~~~~~~~~~~~~ src/core/ngx_murmurhash.c:38:5: note: here case 2: ^~~~ src/core/ngx_murmurhash.c:39:11: error: this statement may fall through [-Werror=implicit-fallthrough=] h ^= data[1] 8; ~~^~~~~~~~~~~~~~~ src/core/ngx_murmurhash.c:40:5: note: here case 1: ^~~~ \u539f\u56e0\uff0c\u662f\u5c06\u8b66\u544a\u5f53\u6210\u4e86\u9519\u8bef\u5904\u7406\uff0c\u6253\u5f00/nginx-src/objs/Makefile\uff0c \u53bb\u6389CFLAGS\u4e2d\u7684-Werror \u518d\u91cd\u65b0make -Wall \u8868\u793a\u6253\u5f00gcc\u7684\u6240\u6709\u8b66\u544a -Werror\uff0c\u5b83\u8981\u6c42gcc\u5c06\u6240\u6709\u7684\u8b66\u544a\u5f53\u6210\u9519\u8bef\u8fdb\u884c\u5904\u7406 vi objs/Makefile \u7b2c\u4e8c\u4e2a\uff0c#include \"common_define.h\"\uff1a # \u62a5\u9519 Fatal error: can't create objs/addon/src/ngx_http_fastdfs_module.o: Permission denied In file included from /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src/common.c:26:0, from /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src/ngx_http_fastdfs_module.c:6: /usr/include/fastdfs/fdfs_define.h:15:27: fatal error: common_define.h: No such file or directory # \u89e3\u51b3 # \u4fee\u6539fastdfs-nginx-module\u7684src/config\u6587\u4ef6 $ cd /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src $ sudo vi config # \u4fee\u6539\u4e00\u4e0b\u4e24\u9879\uff1a ngx_module_incs= /usr/include/fastdfs /usr/include/fastcommon/ CORE_INCS= $CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/ # \u91cd\u65b0\u8fd0\u884c ./configure --prefix=/opt/nginx --sbin-path=/usr/bin/nginx --add-module=~/caibh/fdfs-package/fastdfs-nginx-module-1.20/src $ pwd /home/xxxx/caibh/nginx-src $ sudo make $ sudo make install \u68c0\u67e5nginx\u662f\u5426\u6b63\u5e38\uff1a # \u68c0\u67e5\u81ea\u5df1\u7f16\u8bd1\u51fa\u6765\u7684nginx\u80fd\u5426\u8fd0\u884c $ ./nginx -v nginx version: nginx/1.10.3 \u914d\u7f6enginx\uff0c\u52a0\u5165\u8def\u7531\u89c4\u5219\uff0c\u6620\u5c04\u5230fastdfs\u7684\u6570\u636e\u76ee\u5f55\uff1a # config for fastdfs-nginx-module server { listen 8777; location /M00 { root ~/fdfs/data; ngx_fastdfs_module; } } \u8bbf\u95ee\uff1a http://191.8.2.203:8777/M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945_big.jpg # \u5982\u679c\u80fd\u770b\u5230\u56fe\u7247\u5219\u8868\u793a\u5b89\u88c5fastdfs-nginx-module\u6210\u529f","title":"\u5b89\u88c5fastdfs-nginx-module\uff08\u673a\u5668\u4e0a\u65e0nginx\uff09"},{"location":"fastdfs/#fastdfs-nginx-modulenginx_1","text":"\u601d\u8def\uff1a \u5b89\u88c5\u8fc7\u7a0b\u6bd4\u8f83\u590d\u6742\uff0c\u7531\u4e8e\u5f53\u524d\u7cfb\u7edf\u5df2\u7ecf\u6709\u4e00\u4e2anginx\u5728\u8fd0\u884c\u4e86\uff0c\u6240\u4ee5\u8981\u5148\u786e\u8ba4\u5f53\u524d\u7cfb\u7edfnginx\u7684\u7248\u672c\uff0c\u7136\u540e\u5230\u5b98\u7f51\u4e0b\u8f7d\u5bf9\u5e94\u7248\u672c\u7684nginx\u6e90\u7801\uff0c\u7136\u540e\u67e5\u770b\u7cfb\u7edfnginx\u7684\u7f16\u8bd1\u9009\u9879\uff0c\u7528\u4e00\u6a21\u4e00\u6837\u7684\u7f16\u8bd1\u9009\u9879\u5916\u52a0 fastdfs-nginx-module \u7684\u6e90\u7801\uff0c\u91cd\u65b0\u7f16\u8bd1\u4e00\u4e2anginx\u7a0b\u5e8f\u3002\u7528\u65b0\u7684nginx\u66ff\u6362\u7cfb\u7edf\u7684nginx\u3002 \u6ce8\u610f\uff1a \u8fd9\u91cc\u7684\u5b89\u88c5\u573a\u666f\u662ftracker\u548cstorage\u90fd\u88c5\u5728\u540c\u4e00\u4e2a\u673a\u5668\u4e0a\u3002 \u67e5\u770b\u5df2\u5b89\u88c5\u5e76\u5728\u8fd0\u884c\u4e2d\u7684nginx\u7684\u7248\u672c\uff1a $ nginx -v nginx version: nginx/1.10.3 (Ubuntu) \u5230\u5b98\u7f51\u4e0b\u8f7d\u5bf9\u5e94\u7248\u672c\u7684 nginx\u6e90\u7801 \uff0c\u5e76\u89e3\u538b\uff0c\u6539\u540d\u4e3a nginx-src \uff0c\u7136\u540e\u8fdb\u5165 nginx-src \u76ee\u5f55 \u67e5\u770b\u5f53\u524d\u8fd0\u884c\u7684ngxin\u539f\u6765\u7684\u7f16\u8bd1\u9009\u9879\uff1a $ cd ~/caibh/nginx-src $ nginx -V nginx version: nginx/1.10.3 (Ubuntu) built with OpenSSL 1.0.2g 1 Mar 2016 TLS SNI support enabled configure arguments: --with-cc-opt='-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2' --with-ld-opt='-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now' --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-ipv6 --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_addition_module --with-http_dav_module --with-http_geoip_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module --with-http_v2_module --with-http_sub_module --with-http_xslt_module --with-stream --with-stream_ssl_module --with-mail --with-mail_ssl_module --with-threads \u4e3a\u4e86\u65b9\u4fbf\u7f16\u8f91\uff0c\u590d\u5236\u4e0a\u9762\u4fe1\u606f\uff0c\u5728 nginx-src \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a custom_configure.sh \u6587\u4ef6\uff0c\u628a\u590d\u5236\u7684\u5185\u5bb9\u62f7\u8d1d\u8fdb\u53bb\uff0c\u5e76\u5728\u6700\u540e\u52a0\u4e0a fastdfs-nginx-module \u7684\u6e90\u7801\uff1a $ cd ~/caibh/nginx-src $ cat custom_configure.sh ./configure \\ --with-cc-opt='-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2' \\ --with-ld-opt='-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now' \\ --prefix=/usr/share/nginx \\ --conf-path=/etc/nginx/nginx.conf \\ --http-log-path=/var/log/nginx/access.log \\ --error-log-path=/var/log/nginx/error.log \\ --lock-path=/var/lock/nginx.lock \\ --pid-path=/run/nginx.pid \\ --http-client-body-temp-path=/var/lib/nginx/body \\ --http-fastcgi-temp-path=/var/lib/nginx/fastcgi \\ --http-proxy-temp-path=/var/lib/nginx/proxy \\ --http-scgi-temp-path=/var/lib/nginx/scgi \\ --http-uwsgi-temp-path=/var/lib/nginx/uwsgi \\ --with-debug \\ --with-pcre-jit \\ --with-ipv6 \\ --with-http_ssl_module \\ --with-http_stub_status_module \\ --with-http_realip_module \\ --with-http_auth_request_module \\ --with-http_addition_module \\ --with-http_dav_module \\ --with-http_geoip_module \\ --with-http_gunzip_module \\ --with-http_gzip_static_module \\ --with-http_image_filter_module \\ --with-http_v2_module \\ --with-http_sub_module \\ --with-http_xslt_module \\ --with-stream \\ --with-stream_ssl_module \\ --with-mail \\ --with-mail_ssl_module \\ --with-threads \\ --add-module=~/caibh/fdfs-package/fastdfs-nginx-module-1.20/src \u6267\u884c custom_configure.sh \uff1a # ~/caibh/nginx-src # \u6267\u884c\u7f16\u8bd1 $ sudo ./custom_configure.sh # \u62a5\u9519 ./configure: error: the HTTP XSLT module requires the libxml2/libxslt libraries. You can either do not enable the module or install the libraries. # \u89e3\u51b3 sudo apt-get install libxml2 libxml2-dev libxslt-dev # \u518d\u6b21\u6267\u884c $ sudo ./custom_configure.sh # \u62a5\u9519 ./configure: error: the HTTP image filter module requires the GD library. You can either do not enable the module or install the libraries. #\u89e3\u51b3 sudo apt-get install libgd-dev # \u518d\u6b21\u6267\u884c $ sudo ./custom_configure.sh # \u62a5\u9519 ./configure: error: the GeoIP module requires the GeoIP library. You can either do not enable the module or install the library. # \u641c\u7d22 $ sudo apt-cache search geoip geoclue-ubuntu-geoip - Provide positioning for GeoClue via Ubuntu GeoIP services geoip-bin - IP lookup command line tools that use the GeoIP library geoip-database - IP lookup command line tools that use the GeoIP library (country database) geoip-dbg - debugging symbols for the GeoIP packages libgeoip-dev - Development files for the GeoIP library ..... # \u89e3\u51b3 $ sudo apt-install libgeoip-dev \u6267\u884c\u540e\u6709\u7528\u7684\u4fe1\u606f\uff0c\u901a\u8fc7\u8fd9\u4e9b\u4fe1\u606f\u53ef\u4ee5\u77e5\u9053\u7f16\u8bd1\u51fa\u6765\u7684nginx\u4f1a\u88c5\u5230\u54ea\u91cc\uff0c\u914d\u7f6e\u6587\u4ef6\u4f1a\u653e\u5728\u54ea\u91cc\uff0c\u9519\u8bef\u65e5\u5fd7\u4f1a\u653e\u5728\u54ea\u91cc\uff1a Configuration summary + using threads + using system PCRE library + using system OpenSSL library + md5: using OpenSSL library + sha1: using OpenSSL library + using system zlib library nginx path prefix: /usr/share/nginx nginx binary file: /usr/share/nginx/sbin/nginx nginx modules path: /usr/share/nginx/modules nginx configuration prefix: /etc/nginx nginx configuration file: /etc/nginx/nginx.conf nginx pid file: /run/nginx.pid nginx error log file: /var/log/nginx/error.log nginx http access log file: /var/log/nginx/access.log nginx http client request body temporary files: /var/lib/nginx/body nginx http proxy temporary files: /var/lib/nginx/proxy nginx http fastcgi temporary files: /var/lib/nginx/fastcgi nginx http uwsgi temporary files: /var/lib/nginx/uwsgi nginx http scgi temporary files: /var/lib/nginx/scgi \u505c\u6b62nginx\uff0c\u5e76\u5907\u4efd\u539f\u6765\u7684nginx\u6267\u884c\u6587\u4ef6\uff0c\u548c\u914d\u7f6e\u6587\u4ef6\uff1a $ which nginx /usr/sbin/nginx $ sudo cp /usr/sbin/nginx /usr/sbin/nginx_org_bak $ sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak \u7ee7\u7eed\u5728 nginx-src \u76ee\u5f55\u6267\u884c make \u548c make install \uff1a $ cd ~/caibh/nginx-src $ sudo make # \u62a5\u9519 Fatal error: can't create objs/addon/src/ngx_http_fastdfs_module.o: Permission denied In file included from /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src/common.c:26:0, from /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src/ngx_http_fastdfs_module.c:6: /usr/include/fastdfs/fdfs_define.h:15:27: fatal error: common_define.h: No such file or directory # \u89e3\u51b3 # \u4fee\u6539fastdfs-nginx-module\u7684src/config\u6587\u4ef6 $ cd /home/xxxx/caibh/fdfs-package/fastdfs-nginx-module-1.20/src $ sudo vi config # \u4fee\u6539\u4e00\u4e0b\u4e24\u9879\uff1a ngx_module_incs= /usr/include/fastdfs /usr/include/fastcommon/ CORE_INCS= $CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/ # \u91cd\u65b0\u8fd0\u884c nginx-src/custom_configure.sh $ pwd /home/xxxx/caibh/nginx-src $ sudo ./custom_configure.sh $ sudo make $ sudo make install # make install \u4f1a\u5728/usr/share/nginx/sbin\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2a\u540d\u4e3anginx\u7684\u53ef\u6267\u884c\u6587\u4ef6 $ sudo ls /usr/share/nginx html sbin \u5173\u95ed\u7cfb\u7edf\u539f\u6709\u7684nginx\uff0c\u5e76\u5907\u4efd\u597d\u7cfb\u7edf\u539f\u6765\u7684nginx\u6587\u4ef6\uff1a sudo nginx -s stop cd /usr/sbin sudo cp mv /usr/sbin/nginx /usr/sbin/nginx_bak \u5907\u4efd\u597d\u540e\u521b\u5efa\u4e00\u4e2a\u8f6f\u94fe\u63a5\uff0c\u653e\u5728 /usr/sbin \u76ee\u5f55\u4e0b\uff1a # \u68c0\u67e5\u81ea\u5df1\u7f16\u8bd1\u51fa\u6765\u7684nginx\u80fd\u5426\u8fd0\u884c $ ./nginx -v nginx version: nginx/1.10.3 # \u521b\u5efa\u8f6f\u94fe\u63a5 $ sudo ln -s /usr/share/nginx/sbin/nginx /usr/sbin/nginx \u914d\u7f6enginx\uff0c\u52a0\u5165\u8def\u7531\u89c4\u5219\uff0c\u6620\u5c04\u5230fastdfs\u7684\u6570\u636e\u76ee\u5f55\uff1a # config for fastdfs-nginx-module server { listen 8777; location /M00 { root ~/fdfs/data; ngx_fastdfs_module; } } \u5f00\u653e\u7aef\u53e3\uff1a sudo iptables -A IN_public_allow -p tcp --dport 8777 -j ACCEPT sudo iptables -L -n \u6d4b\u8bd5\u4e0a\u4f20\u56fe\u7247\uff1a $ fdfs_test /etc/fdfs/client.conf upload ~/caibh/test_images/XinXiJuZhiWang.jpg This is FastDFS client test program v5.11 Copyright (C) 2008, Happy Fish / YuQing FastDFS may be copied only under the terms of the GNU General Public License V3, which may be found in the FastDFS source kit. Please visit the FastDFS Home Page http://www.csource.org/ for more detail. [2019-02-22 14:54:33] DEBUG - base_path=/home/xxxx/fdfs/client, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0 tracker_query_storage_store_list_without_group: server 1. group_name=, ip_addr=191.8.2.203, port=23000 group_name=group1, ip_addr=191.8.2.203, port=23000 storage_upload_by_filename group_name=group1, remote_filename=M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945.jpg source ip address: 191.8.2.203 file timestamp=2019-02-22 14:54:33 file size=68829 file crc32=1940417678 example file url: http://191.8.2.203:9270/group1/M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945.jpg storage_upload_slave_by_filename group_name=group1, remote_filename=M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945_big.jpg source ip address: 191.8.2.203 file timestamp=2019-02-22 14:54:33 file size=68829 file crc32=1940417678 example file url: http://191.8.2.203:9270/group1/M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945_big.jpg \u8bbf\u95ee\uff1a http://191.8.2.203:8777/M00/00/00/vwgCy1xvnKmAIDXDAAEM3XOobI4945_big.jpg # \u5982\u679c\u80fd\u770b\u5230\u56fe\u7247\u5219\u8868\u793a\u5b89\u88c5fastdfs-nginx-module\u6210\u529f","title":"\u5b89\u88c5fastdfs-nginx-module\uff08\u673a\u5668\u4e0a\u6709nginx\uff09"},{"location":"fastdfs/#1fastdfs","text":"FastDFS\u662f\u4e00\u6b3e\u9ad8\u6027\u80fd\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002\u4e3b\u8981\u529f\u80fd\u5305\u62ec\uff1a\u6587\u4ef6\u5b58\u50a8\uff0c\u6587\u4ef6\u540c\u6b65\uff0c\u6587\u4ef6\u8bbf\u95ee\uff08\u4e0a\u4f20\u4e0b\u8f7d\uff09\u3002\u5b83\u53ef\u4ee5\u89e3\u51b3\u9ad8\u5bb9\u91cf\u548c\u8d1f\u8f7d\u5747\u8861\u7684\u95ee\u9898\u3002FastDFS\u9002\u5408\u7528\u6765\u505a\u6587\u4ef6\u76f8\u5173\u7684\u7f51\u7ad9\uff0c\u5982\u56fe\u7247\u5206\u4eab\u3001\u89c6\u9891\u5206\u4eab\u7b49\u3002 FastDFS\u6709\u4e24\u79cd\u89d2\u8272\uff1a tracker \u548c storage \u3002 tracker \u8d1f\u8d23\u6587\u4ef6\u8bbf\u95ee\u7684\u8ddf\u8e2a\u548c\u8d1f\u8f7d\u5747\u8861\u3002 storage \u8d1f\u8d23\u5b58\u50a8\u6587\u4ef6\uff0c\u5b83\u7684\u529f\u80fd\u5305\u62ec\uff1a\u6587\u4ef6\u5b58\u50a8\u3001\u6587\u4ef6\u540c\u6b65\u3001\u63d0\u4f9b\u6587\u4ef6\u8bbf\u95ee\u63a5\u53e3\uff0c storage \u8fd8\u8d1f\u8d23\u7ba1\u7406\u6587\u4ef6\u7684\u5143\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u662f\u4ee5\u952e\u503c\u5bf9\u7684\u5f62\u5f0f\u8868\u793a\u7684\uff0c\u5982\uff1awidth=1024\uff0c\u952e\u662f\u201cwidth\u201d\uff0c\u503c\u662f\u201c1024\u201d\u3002 tracker \u548c storage \u53ef\u4ee5\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u670d\u52a1\u5668\u3002\u5728 tracker \u6216 storage \u7684\u96c6\u7fa4\u4e2d\uff0c\u4efb\u4f55\u65f6\u5019\u90fd\u53ef\u4ee5\u4ece\u4e2d\u5220\u9664\u670d\u52a1\u5668\uff0c\u5bf9\u7ebf\u4e0a\u670d\u52a1\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\u3002 tracker \u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u5668\u662f\u70b9\u5bf9\u70b9\u7684\u3002 \u5b58\u50a8\u670d\u52a1\u5668\u4ee5 \u5377/\u7ec4 \u5f62\u5f0f\u7ec4\u7ec7\uff0c\u4ee5\u83b7\u53d6\u9ad8\u5bb9\u91cf\u3002\u5b58\u50a8\u7cfb\u7edf\u5305\u62ec\u4e00\u4e2a\u6216\u591a\u4e2a\u5377\uff0c\u5377\u4e0e\u5377\u4e4b\u95f4\u7684\u6587\u4ef6\u662f\u76f8\u4e92\u72ec\u7acb\u7684\u3002\u6574\u4e2a\u5b58\u50a8\u7cfb\u7edf\u7684\u603b\u5bb9\u91cf\u7b49\u4e8e\u6240\u6709\u5377\u7684\u5bb9\u91cf\u4e4b\u548c\u3002\u4e00\u4e2a\u6587\u4ef6\u5377\u5305\u62ec\u4e00\u4e2a\u6216\u591a\u4e2a\u5b58\u50a8\u670d\u52a1\u5668\uff0c\u4e00\u4e2a\u5377\u4e2d\u7684\u5b58\u50a8\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u6587\u4ef6\u662f\u4e00\u6837\u7684\u3002\u4e00\u4e2a\u6587\u4ef6\u5377\u4e2d\u7684\u670d\u52a1\u5668\u4f1a\u4e92\u76f8\u5907\u4efd\uff0c\u4e14\u8fd9\u4e9b\u670d\u52a1\u5668\u4e4b\u95f4\u662f\u8d1f\u8f7d\u5747\u8861\u7684\u3002\u5f53\u6dfb\u52a0\u4e00\u4e2a\u5b58\u50a8\u670d\u52a1\u5668\u5230\u4e00\u4e2a\u5377\u7684\u65f6\u5019\uff0c\u5377\u4e2d\u7684\u6587\u4ef6\u4f1a\u81ea\u52a8\u590d\u5236\u5230\u65b0\u7684\u670d\u52a1\u5668\uff0c\u590d\u5236\u5b8c\u4ee5\u540e\uff0c\u7cfb\u7edf\u4f1a\u628a\u65b0\u670d\u52a1\u5668\u5207\u6362\u5230\u7ebf\u4e0a\uff0c\u5df2\u63d0\u4f9b\u5b58\u50a8\u670d\u52a1\u3002 \u5f53\u5b58\u50a8\u5bb9\u91cf\u4e0d\u8db3\u65f6\uff0c\u4f60\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u5377\u6765\u6269\u5c55\u5b58\u50a8\u5bb9\u91cf\u3002 \u4e00\u4e2a\u6587\u4ef6\u7684\u6807\u8bc6\u5305\u62ec\u4e24\u90e8\u5206\uff1a\u5377\u540d\u548c\u6587\u4ef6\u540d","title":"\u9644\u5f551\uff1aFastDFS \u5b98\u7f51\u4ecb\u7ecd"},{"location":"fastdfs/#2fastdfsinstall","text":"step 1. \u4e0b\u8f7d\u5b89\u88c5 libfastcommon \u5730\u5740\uff1a https://github.com/happyfish1... step 2. \u4e0b\u8f7d\u5b89\u88c5 FastDFS \u89e3\u538b\uff1a tar xzf FastDFS_v5.08.tar.gz step 3. \u8fdb\u5165FastDFS\u7684\u76ee\u5f55 cd FastDFS step 4. \u6267\u884cmake: ./make.sh step 5. \u6267\u884cmake install ./make.sh install step 6. \u4fee\u6539 tracker \u548c storage \u7684\u914d\u7f6e\u6587\u4ef6\uff1a /etc/fdfs/tracker.conf \u51e0\u4e2a\u91cd\u8981\u7684\u914d\u7f6e\uff1a # the tracker server port port=22122 # the base path to store data and log files base_path=/home/caibh/fdfs # which group to upload file # when store_lookup set to 1, must set store_group to the group name store_group=group2 # HTTP port on this tracker server http.server_port=9270 /etc/fdfs/storage.conf \u51e0\u4e2a\u91cd\u8981\u7684\u914d\u7f6e\uff1a # the storage server port port=23000 # the base path to store data and log files base_path=/home/caibh/fdfs # store_path#, based 0, if store_path0 not exists, it's value is base_path # the paths must be exist store_path0=/home/caibh/fdfs #store_path1=/home/caibh/fdfs2 # tracker_server can ocur more than once, and tracker_server format is # host:port , host can be hostname or ip address # \u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u914d\u7f6etracker\u548cstorage\u65f6\uff0c\u8fd9\u91cc\u5982\u679c\u662f127.0.0.1\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u8981\u914d\u7f6e\u771f\u6b63\u7684ip\u5730\u5740\u3002 tracker_server=191.8.1.77:22122 # the port of the web server on this storage server http.server_port=8888 step 7. run server programs \u542f\u52a8tracker\uff1a /usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart in Linux, you can start fdfs_trackerd as a service: /sbin/service fdfs_trackerd start \u542f\u52a8storage\uff1a /usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart in Linux, you can start fdfs_storaged as a service: /sbin/service fdfs_storaged start step 8. \u6d4b\u8bd5 \u4fee\u6539\u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6\uff1a /etc/fdfs/client.conf \u51e0\u4e2a\u91cd\u8981\u7684\u914d\u7f6e\uff1a # the base path to store log files base_path=/home/caibh/fdfs/client # tracker_server can ocur more than once, and tracker_server format is # host:port , host can be hostname or ip address tracker_server=191.8.1.77:22122 #HTTP settings http.tracker_server_port=9270 run the client test program: /usr/bin/fdfs_test client_conf_filename operation /usr/bin/fdfs_test1 client_conf_filename operation \u4f8b\u5982\u4e0a\u4f20\u4e00\u4e2a\u56fe\u7247\u6587\u4ef6\uff1a caibh@pc:~$ fdfs_test /etc/fdfs/client.conf upload /develop/fastdfs/test_file/LiuLangDiQiu.jpg This is FastDFS client test program v5.11 Copyright (C) 2008, Happy Fish / YuQing FastDFS may be copied only under the terms of the GNU General Public License V3, which may be found in the FastDFS source kit. Please visit the FastDFS Home Page http://www.csource.org/ for more detail. [2019-02-19 11:32:30] DEBUG - base_path=/home/caibh/fdfs/client, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0 tracker_query_storage_store_list_without_group: server 1. group_name=, ip_addr=191.8.1.77, port=23000 group_name=group1, ip_addr=191.8.1.77, port=23000 storage_upload_by_filename group_name=group1, remote_filename=M00/00/00/vwgBTVxreM6AD-mcAAEE_qeEI2s285.jpg source ip address: 191.8.1.77 file timestamp=2019-02-19 11:32:30 file size=66814 file crc32=2810454891 example file url: http://191.8.1.77:9270/group1/M00/00/00/vwgBTVxreM6AD-mcAAEE_qeEI2s285.jpg storage_upload_slave_by_filename group_name=group1, remote_filename=M00/00/00/vwgBTVxreM6AD-mcAAEE_qeEI2s285_big.jpg source ip address: 191.8.1.77 file timestamp=2019-02-19 11:32:30 file size=66814 file crc32=2810454891 example file url: http://191.8.1.77:9270/group1/M00/00/00/vwgBTVxreM6AD-mcAAEE_qeEI2s285_big.jpg step 9. \u67e5\u770b\u72b6\u6001 run the monitor program: /usr/bin/fdfs_monitor client_conf_filename # \u5982\uff1a caibh@pc:~$ fdfs_monitor /etc/fdfs/storage.conf [2019-02-19 10:25:09] DEBUG - base_path=/home/caibh/fdfs, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0 server_count=1, server_index=0 tracker server is 191.8.1.77:22122 group count: 1 Group 1: group name = group1 disk total space = 111868 MB disk free space = 62228 MB trunk free space = 0 MB storage server count = 1 active server count = 1 storage server port = 23000 storage HTTP port = 8888 store path count = 1 subdir count per path = 256 current write server index = 0 current trunk file id = 0 Storage 1: id = 191.8.1.77 ip_addr = 191.8.1.77 (191-8-1-77.user.vivozap.com.br) ACTIVE http domain = version = 5.11 join time = 2019-02-19 10:22:53 up time = 2019-02-19 10:22:53 total storage = 111868 MB free storage = 62228 MB upload priority = 10 store_path_count = 1 subdir_count_per_path = 256 storage_port = 23000 storage_http_port = 8888 tracker server config file sample please see conf/tracker.conf storage server config file sample please see conf/storage.conf client config file sample please see conf/client.conf Item detail server common items item name type default Must base_path string Y disabled boolean false N bind_addr string N network_timeout int 30(s) N max_connections int 256 N log_level string info N run_by_group string N run_by_user string N allow_hosts string * N sync_log_buff_interval int 10(s) N thread_stack_size string 1M N memo: base_path is the base path of sub dirs: data and logs. base_path must exist and it's sub dirs will be automatically created if not exist. $base_path/data: store data files $base_path/logs: store log files log_level is the standard log level as syslog, case insensitive emerg: for emergency alert crit: for critical error warn: for warning notice info debug allow_hosts can ocur more than once, host can be hostname or ip address, \"*\" means match all ip addresses, can use range like this: 10.0.1.[1-15,20] or host[01-08,20-25].domain.com, for example: allow_hosts=10.0.1.[1-15,20] allow_hosts=host[01-08,20-25].domain.com tracker server items item name type default Must item name type default Must port int 22000 N store_lookup int 0 N store_group string N store_server int 0 N store_path int 0 N download_server int 0 N reserved_storage_space string 1GB N memo: the value of store_lookup is: 0: round robin (default) 1: specify group 2: load balance (supported since V1.1) store_group is the name of group to store files. when store_lookup set to 1(specify group), store_group must be set to a specified group name. reserved_storage_space is the reserved storage space for system or other applications. if the free(available) space of any stoarge server in a group = reserved_storage_space, no file can be uploaded to this group (since V1.1) bytes unit can be one of follows: G or g for gigabyte(GB) M or m for megabyte(MB) K or k for kilobyte(KB) no unit for byte(B) storage server items item name type default Must group_name string Y tracker_server string Y port int 23000 N heart_beat_interval int 30(s) N stat_report_interval int 300(s) N sync_wait_msec int 100(ms) N sync_interval int 0(ms) N sync_start_time string 00:00 N sync_end_time string 23:59 N store_path_count int 1 N store_path0 string base_path N store_path# string N subdir_count_per_path int 256 N check_file_duplicate boolean 0 N key_namespace string N keep_alive boolean 0 N sync_binlog_buff_interval int 60s N memo: tracker_server can ocur more than once, and tracker_server format is \"host:port\", host can be hostname or ip address. store_path#, # for digital, based 0 check_file_duplicate: when set to true, must work with FastDHT server, more detail please see INSTALL of FastDHT. FastDHT download page: http://code.google.com/p/fast... key_namespace: FastDHT key namespace, can't be empty when check_file_duplicate is true. the key namespace should short as possible","title":"\u9644\u5f552\uff1aFastDFS\u5b98\u65b9INSTALL\u6587\u4ef6"},{"location":"fastdfs/#3fastdfs-nginxinstall","text":"step 1. first install the FastDFS storage server and client library, the FastDFS version should = 5.11. download address: https://github.com/happyfish1... step 2. install nginx server \u200b FastDFS nginx module test passed with nginx 1.15.1, \u200b my nginx installed in /usr/local/nginx step 3. download FastDFS nginx module source package and unpack it, such as: cd /home/yuqing git clone https://github.com/happyfish100/fastdfs step 4. enter the nginx source dir, compile and install the module, such as: cd nginx-1.15.1 ./configure --add-module=/home/yuqing/fastdfs-nginx-module/src make; make install \u6ce8\u610f: before compile, you can change FDFS_OUTPUT_CHUNK_SIZE and FDFS_MOD_CONF_FILENAME macro in the config file as: CFLAGS=\"$CFLAGS -D_FILE_OFFSET_BITS=64 -DFDFS_OUTPUT_CHUNK_SIZE='256*1024' -DFDFS_MOD_CONF_FILENAME='\\\"/etc/fdfs/mod_fastdfs.conf\\\"'\" step 5. config the nginx config file such as nginx.conf, add the following lines: location /M00 { root /home/yuqing/fastdfs/data; ngx_fastdfs_module; } step 6. \u521b\u5efa\u8f6f\u94fe\u63a5 ${fastdfs_base_path}/data/M00 \u94fe\u63a5\u5230 ${fastdfs_base_path}/data \uff0c\u547d\u4ee4\u5982\u4e0b\uff1a ln -s /home/yuqing/fastdfs/data /home/yuqing/fastdfs/data/M00 step 7. change the config file /etc/fdfs/mod_fastdfs.conf, more detail please see it step 8. \u91cd\u542fnginx\uff1a /usr/local/nginx/sbin/nginx -s stop; /usr/local/nginx/sbin/nginx","title":"\u9644\u5f553\uff1aFastDFS Nginx\u6a21\u5757\u5b98\u65b9INSTALL\u6587\u4ef6"}]}